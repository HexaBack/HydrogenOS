title: Welcome to HydrogenOS
properties:
  mode: "run-on-change"
screens:
  first-screen:
    source: yafti.screen.title
    values:
      title: "Welcome to HydrogenOS (rolling alpha)"
      icon: "/usr/share/icons/oxygen/base/256x256/categories/preferences-desktop.png"
      description: |
        Some final tweaks need to be applied for a smooth experience.
  can-we-modify-your-flatpaks:
    source: yafti.screen.consent
    values:
      title: Additional software repositories
      condition:
        run: flatpak remotes --columns=name | grep fedora
      description: |
        Your system is currently using the limited Fedora-provided Flatpak remote, whose applications are usually missing important codecs and other features. This step will migrate them to their up-to-date upstream Flathub equivalents. If you don't want to do this, simply close this window.
      actions:
        - run: flatpak remote-delete --system --force fedora
        - run: flatpak remote-delete --user --force fedora
        - run: flatpak remove --system --noninteractive --all
        - run: flatpak remote-add --if-not-exists --system flathub https://flathub.org/repo/flathub.flatpakrepo
        - run: flatpak remote-add --if-not-exists --user flathub https://flathub.org/repo/flathub.flatpakrepo
  check-system-flathub:
    source: yafti.screen.consent
    values:
      title: Missing Flathub Repository (System)
      condition:
        run: flatpak remotes --system --columns=name | grep flathub | wc -l | grep '^0$'
      description: |
        Your system does not contain any Flatpak remotes. Flathub will now be added to the system-wide remote list. This is neccessary to be able to install applications from Discover.
      actions:
        - run: flatpak remote-add --if-not-exists --system flathub https://flathub.org/repo/flathub.flatpakrepo
  check-user-flathub:
    source: yafti.screen.consent
    values:
      title: Missing Flathub Repository (User)
      condition:
        run: flatpak remotes --user --columns=name | grep flathub | wc -l | grep '^0$'
      description: |
        Your user does not contain any Flatpak remotes. Flathub will now be added to your user's remote list. This is neccessary for user-confined applications.
      actions:
        - run: flatpak remote-add --if-not-exists --user flathub https://flathub.org/repo/flathub.flatpakrepo
  final-screen:
    source: yafti.screen.title
    values:
      title: "Setup complete"
      icon: "/usr/share/icons/oxygen/base/128x128/status/security-high.png"
      links:
        - "Discover Flatpak apps":
            run: /usr/bin/plasma-discover
        - "More KDE software":
            run: /usr/bin/xdg-open https://apps.kde.org
        - "Configure everything imaginable":
            run: /usr/bin/systemsettings
      description: |
        HydrogenOS setup is complete. If you want to delete any built-in application, do so by running in a terminal: rpm-ostree override remove application-name. Likewise, you can also install an application system-wide (necessary for Oxygen theming to work) by running: rpm-ostree install application-name. Use Discover to install flatpaks of everything else.